<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aromea - Menu</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="ajout-message" class="ajout-flottant">‚úÖ Article ajout√© au panier</div>

  <!-- ===== CHARGEMENT DU HEADER ===== -->
  <div id="header"></div>

  <!-- ===== CONTENU DE LA PAGE MENU ===== -->
  <main class="menu-page">
    <div id="total-menu" style="text-align: right; font-weight: bold; color: #f97316; margin-bottom: 20px;">
      Total actuel : 0,00 ‚Ç¨
    </div>
    
    <h2>Notre Menu</h2>

    <!-- === PLATS THA√èLANDAIS === -->
    <section class="menu-section" id="plats">
      <h3>Plats Tha√Ølandais</h3>
      <div id="plats-container" class="menu-grid">
        <!-- Les articles vont √™tre ajout√©s ici dynamiquement depuis Firestore -->
      </div>
    </section>

    <!-- === DESSERTS === -->
    <section class="menu-section" id="desserts">
      <h3>Desserts</h3>
      <div id="desserts-container" class="menu-grid">
        <!-- Les desserts vont √™tre ajout√©s ici dynamiquement -->
      </div>
    </section>

    <!-- === BOISSONS === -->
    <section class="menu-section" id="boissons">
      <h3>Boissons</h3>
      <div id="boissons-container" class="menu-grid">
        <!-- Les boissons vont √™tre ajout√©es ici dynamiquement -->
      </div>
    </section>
  </main>

  <!-- ===== CHARGEMENT DU FOOTER ===== -->
  <div id="footer"></div>

  <!-- ===== SCRIPTS ===== -->
  <script type="module">
    // üîπ Importer les fonctions n√©cessaires de Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

    // üîπ Configuration de ton projet Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBKpabQB5rKC1zCAyy1puKO3G1YzK0SIxA",
      authDomain: "aromea-9c2f0.firebaseapp.com",
      projectId: "aromea-9c2f0",
      storageBucket: "aromea-9c2f0.appspot.com",
      messagingSenderId: "974441059113",
      appId: "1:974441059113:web:b6d1f607707ad50a209d38"
    };

    // üîπ Initialiser Firebase et Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // üîπ Fonction pour afficher les articles du menu
    async function afficherMenu() {
      const articlesCollection = collection(db, "articles"); // Rechercher la collection 'articles' dans Firestore
      const querySnapshot = await getDocs(articlesCollection); // R√©cup√©rer tous les documents dans la collection 'articles'

      // V√©rifier si la collection est vide
      if (querySnapshot.empty) {
        console.log("Aucun article trouv√© dans la base de donn√©es.");
        return;
      }

      querySnapshot.forEach(doc => {
        const data = doc.data(); // R√©cup√©rer les donn√©es de chaque article

        // Dynamique pour afficher les articles dans les sections (Plats, Desserts, Boissons)
        const menuContainer = document.getElementById(data.categorie + "-container"); // S√©lectionner la bonne cat√©gorie d'articles

        // Cr√©er un √©l√©ment pour chaque article
        const articleDiv = document.createElement("div");
        articleDiv.className = "menu-item"; // Ajouter une classe CSS pour chaque article

        // Remplir le div avec les donn√©es de l'article
        articleDiv.innerHTML = `
          <img src="images/${data.images}" alt="${data.nom}"> <!-- Affichage de l'image -->
          <h4>${data.nom}</h4> <!-- Affichage du nom -->
          <p>${data.description}</p> <!-- Description de l'article -->
          <p class="prix">${data.prix} ‚Ç¨</p> <!-- Affichage du prix -->
          <button class="add-to-cart-btn" data-nom="${data.nom}" data-categorie="${data.categorie}" data-prix="${data.prix}">Ajouter au panier</button> <!-- Bouton d'ajout au panier -->
        `;

        // Ajouter l'article dans la bonne section (Plats, Desserts ou Boissons)
        menuContainer.appendChild(articleDiv);
      });

      // Apr√®s avoir ajout√© les articles, ajouter des √©couteurs d'√©v√©nements pour chaque bouton "Ajouter au panier"
      const buttons = document.querySelectorAll('.add-to-cart-btn');
      buttons.forEach(button => {
        button.addEventListener('click', (e) => {
          const nom = e.target.getAttribute('data-nom');
          const categorie = e.target.getAttribute('data-categorie');
          const prix = parseFloat(e.target.getAttribute('data-prix'));
          ajouterAuPanier(nom, categorie, prix); // Appel de la fonction pour ajouter au panier
        });
      });
    }

    // Appeler la fonction pour afficher les articles d√®s que la page est charg√©e
    afficherMenu();

    // üîπ Fonction pour ajouter un article au panier
    function ajouterAuPanier(nom, categorie, prix) {
      let panier = JSON.parse(localStorage.getItem('panierDetaille')) || []; // R√©cup√©rer le panier existant ou initialiser un tableau vide
      const index = panier.findIndex(item => item.nom === nom && item.categorie === categorie); // V√©rifier si l'article est d√©j√† dans le panier

      if (index !== -1) {
        panier[index].quantite += 1; // Si l'article est d√©j√† dans le panier, augmenter la quantit√©
      } else {
        panier.push({ nom, categorie, prix, quantite: 1 }); // Sinon, ajouter l'article avec une quantit√© de 1
      }

      // Sauvegarder le panier dans le localStorage
      localStorage.setItem('panierDetaille', JSON.stringify(panier));

      // Mettre √† jour l'affichage du total du menu et du badge du panier
      mettreAJourTotalMenu();
      mettreAJourBadgeNav(); // Ajouter un effet sur le badge du panier

      // Afficher un message de confirmation
      const msg = document.getElementById('ajout-message');
      msg.classList.add('visible');
      setTimeout(() => msg.classList.remove('visible'), 1500); // Masquer le message apr√®s 1.5 secondes
    }

    // üîπ Fonction pour mettre √† jour le total actuel du menu
    function mettreAJourTotalMenu() {
      const panier = JSON.parse(localStorage.getItem('panierDetaille')) || [];
      const total = panier.reduce((sum, item) => sum + item.prix * item.quantite, 0); // Calcul du total du panier
      const totalElement = document.getElementById('total-menu');
      if (totalElement) {
        totalElement.textContent = `Total actuel : ${total.toFixed(2).replace('.', ',')} ‚Ç¨`; // Affichage du total
      }
    }

    // üîπ Fonction pour mettre √† jour le badge du panier dans le header
    function mettreAJourBadgeNav() {
      const panier = JSON.parse(localStorage.getItem('panierDetaille')) || [];
      const totalArticles = panier.reduce((sum, item) => sum + item.quantite, 0); // Nombre total d'articles dans le panier
      const badge = document.getElementById('nav-badge');
      if (badge) {
        badge.textContent = totalArticles > 0 ? totalArticles : ''; // Afficher le nombre d'articles ou rien si le panier est vide
        badge.classList.remove('bounce'); // Effacer l'animation pr√©c√©dente
        void badge.offsetWidth; // Relancer l'animation du badge
        badge.classList.add('bounce'); // Ajouter l'animation de rebond
      }
    }

    // Initialiser le badge et le total au chargement de la page
    mettreAJourBadgeNav();
    mettreAJourTotalMenu(); 

    // üîπ Chargement du header et footer dynamiquement
    fetch('header.html').then(res => res.text()).then(data => {
      document.getElementById('header').innerHTML = data;
      mettreAJourBadgeNav(); // üëà Appeler la fonction APR√àS que le header est en place
    });

    fetch('footer.html').then(res => res.text()).then(data => {
      document.getElementById('footer').innerHTML = data;
    });
  </script>

</body>
</html>
